<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>FOCUS MODE - 免分心搜索</title>
    <!-- 优化字体加载策略，使用本地字体 + 网络字体的组合 -->
    <style>
      @font-face {
        font-family: 'Inter';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: local('Inter'), local('Inter Regular');
      }
      
      /* 优化字体堆栈，优先使用系统字体，避免乱码 */
      :root {
        font-family: 
          /* 现代中文字体 */
          -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Noto Sans CJK SC', 'Source Han Sans SC',
          /* Windows中文字体 */
          'Microsoft YaHei', '微软雅黑', 'Microsoft YaHei UI',
          /* 英文字体 */
          'Inter', 'Roboto', 'Helvetica Neue', 'Arial',
          /* 回退字体 */
          sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';
        
        /* 优化字体渲染 */
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeLegibility;
      }
      
      /* 移动端字体大小优化 */
      @media (max-width: 640px) {
        :root {
          font-size: 16px; /* 防止iOS缩放 */
        }
      }
      
      body {
        background-color: #f5f5f7;
        color: #1d1d1f;
      }
      
      /* 隐藏滚动条 */
      .no-scrollbar::-webkit-scrollbar { display: none; }
      .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      
      /* 玻璃面板效果 (用于下拉菜单) */
      .glass-panel {
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.9);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
      }

      /* 整个页面的核心内容外框样式 */
      .app-container {
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1), 0 2px 8px rgba(0, 0, 0, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.8);
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(30px);
        -webkit-backdrop-filter: blur(30px);
      }
      
      /* 快速跳转卡片样式 */
      .card-hover-effect { 
        position: relative;
        overflow: hidden;
        /* 默认样式 */
        border: 2px solid rgba(255, 255, 255, 0.8);
        background: rgba(255, 255, 255, 0.6);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04), 0 1px 4px rgba(0, 0, 0, 0.02);
        transition: all 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
      }
      .card-hover-effect:hover {
        /* 悬停时的边框和阴影 */
        border-color: #007AFF;
        box-shadow: 0 8px 20px rgba(0, 122, 255, 0.15), 0 0 0 3px rgba(0, 122, 255, 0.1);
        transform: scale(1.01);
      }
      .card-hover-effect:active {
        /* 点击反馈 */
        transform: scale(0.98);
        transition: transform 0.1s ease-out;
      }

      /* Subtle hover effect (Gradient) */
      .card-hover-gradient {
        position: absolute;
        inset: 0;
        background: linear-gradient(135deg, rgba(0, 122, 255, 0.05), transparent 65%);
        opacity: 0;
        transition: opacity 0.2s ease;
      }
      .card-hover-effect:hover .card-hover-gradient {
        opacity: 1;
      }

      /* 代码优化点：将文本样式集中定义，实现 MD 文件中的 letter-spacing */
      .card-hover-effect .platform-name {
        font-weight: 600;
        letter-spacing: 0.5px; 
      }
      
      /* 面板动画 */
      .panel-transition {
        transition: opacity 0.3s ease-out, transform 0.3s ease-out;
      }
      .panel-enter { 
        opacity: 0; 
        transform: translateY(-10px); 
      }
      .panel-active { 
        opacity: 1; 
        transform: translateY(0); 
      }
      
      /* 移动端专用优化 */
      @media (max-width: 640px) {
        /* 移动端优化触摸目标大小 */
        .touch-target {
          min-height: 44px;
          min-width: 44px;
        }
        
        /* 移动端优化搜索框 */
        .mobile-search-input {
          font-size: 16px; /* 防止iOS缩放 */
        }
        
        /* 移动端优化按钮间距 */
        .mobile-button-spacing {
          margin: 0.5rem 0;
        }
        
        /* 移动端卡片优化 */
        .mobile-card {
          padding: 1rem;
          margin-bottom: 0.75rem;
        }
      }
      
      /* 优化移动端的网格布局 */
      @media (max-width: 640px) {
        .mobile-grid {
          grid-template-columns: 1fr;
          gap: 0.75rem;
        }
      }
      
      /* 移动端输入框优化 */
      @media (max-width: 640px) {
        .mobile-search-container {
          padding: 0.75rem;
        }
      }
      
      /* 触摸反馈优化 */
      @media (hover: none) and (pointer: coarse) {
        .card-hover-effect:hover {
          transform: none;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04), 0 1px 4px rgba(0, 0, 0, 0.02);
          border-color: rgba(255, 255, 255, 0.8);
        }
        
        .card-hover-effect:active {
          transform: scale(0.95);
          border-color: #007AFF;
          box-shadow: 0 8px 20px rgba(0, 122, 255, 0.15), 0 0 0 3px rgba(0, 122, 255, 0.1);
        }
      }
    </style>
  </head>
  <body class="flex items-center justify-center min-h-screen px-4 py-8 sm:px-8">
    
    <div class="w-full max-w-[660px] p-6 sm:p-10 rounded-[24px] app-container">
      
      <div class="w-full max-w-[615px] mx-auto">
        
        <div class="text-center mb-8 sm:mb-10 space-y-4">
          <h1 class="text-[#1D1D1F] text-[28px] sm:text-[36px] font-semibold tracking-[1px] sm:tracking-[2px]">
            FOCUS MODE
          </h1>
          <p class="text-[#86868B] text-[14px] sm:text-[15px] px-4">
            直达搜索结果，不受信息流干扰，保持专注。
          </p>
        </div>

        <div class="mb-6 relative z-50">
          <label class="block text-[#1D1D1F] mb-3 text-[14px] font-medium">搜索关键词</label>
          
          <div id="searchBox" class="relative bg-white rounded-[16px] border-2 border-[#E5E5EA] transition-all duration-200 focus-within:border-[#007AFF] focus-within:shadow-[0_0_0_4px_rgba(0,122,255,0.1)]">
            <div class="flex items-center gap-2 sm:gap-3 px-3 sm:px-4 py-3">
              
              <button id="platformTrigger" class="touch-target flex items-center gap-2 px-2 sm:px-3 py-2 bg-[#f5f5f7] rounded-[10px] hover:bg-[#e5e5ea] transition-all duration-200 flex-shrink-0 group">
                <div id="currentPlatformIcon" class="w-5 h-5 flex items-center justify-center"></div>
                <span id="currentPlatformName" class="text-[#1D1D1F] text-[14px] font-medium hidden xs:inline">知乎</span>
                <i data-lucide="chevron-down" class="w-4 h-4 text-[#86868B]"></i>
              </button>

              <input id="searchInput" type="text" placeholder="请输入搜索的主题/关键词" class="mobile-search-input flex-1 bg-transparent text-[#1D1D1F] placeholder-[#86868B] outline-none text-[15px]" autocomplete="off" />

              <button id="historyTrigger" class="touch-target px-2 sm:px-3 py-2 text-[#86868B] hover:text-[#007AFF] hover:bg-[#007AFF]/10 rounded-[10px] transition-all duration-200 flex-shrink-0 hidden sm:block">
                <div class="flex items-center gap-2">
                  <i data-lucide="clock" class="w-4 h-4"></i>
                  <span class="text-[14px]">历史</span>
                </div>
              </button>

              <button id="searchBtn" class="touch-target px-4 sm:px-5 py-2 bg-[#86868B] text-white rounded-[10px] transition-all duration-200 flex-shrink-0 active:scale-95 flex items-center gap-2 hover:bg-[#007AFF]">
                <span class="text-[14px] font-medium hidden xs:inline">搜索</span>
                <i data-lucide="search" class="w-4 h-4"></i>
              </button>
            </div>

            <div id="platformPanel" class="absolute top-[calc(100%+8px)] left-0 right-0 p-4 rounded-[16px] glass-panel z-10 hidden panel-transition panel-enter">
              <div class="grid grid-cols-2 sm:grid-cols-3 gap-3" id="platformGrid"></div>
            </div>

            <div id="historyPanel" class="absolute top-[calc(100%+8px)] left-0 right-0 p-3 rounded-[16px] glass-panel z-10 hidden panel-transition panel-enter">
              <div class="flex items-center justify-between mb-3 px-2">
                <span class="text-[#1D1D1F] text-[13px] font-semibold">最近搜索</span>
                <button id="clearHistory" class="text-[#86868B] hover:text-[#FF3B30] text-[12px] touch-target">清空</button>
              </div>
              <div id="historyList" class="space-y-1 max-h-[200px] overflow-y-auto no-scrollbar"></div>
            </div>
          </div>
        </div>

        <div class="mb-8">
          <div class="flex items-end justify-between mb-4">
            <div class="flex items-baseline gap-4"> 
              <span class="text-[#1D1D1F] text-[14px] font-medium">快速跳转</span>
              <span class="text-[#86868B] text-[13px] hidden sm:inline">新标签页打开</span>
            </div>
            <button id="addFavoriteTip" class="text-[#007AFF] text-xs font-medium hover:opacity-80 transition flex-shrink-0 text-right touch-target" aria-label="收藏本页到浏览器">
                <span class="hidden sm:inline">打开浏览器设置，点击收藏/添加到桌面</span>
                <span class="sm:hidden">添加到主屏幕</span>
            </button>
          </div>
          
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4" id="quickJumpGrid"></div>
        </div>

        <div class="text-center text-[#86868B] text-[13px]">
          <div>支持移动端 & 桌面端</div>
        </div>
      </div>
    </div>
    <div id="toast" class="fixed left-1/2 -translate-x-1/2 bottom-10 bg-black/80 text-white px-6 py-3 rounded-full text-sm shadow-lg opacity-0 pointer-events-none transition-all duration-300 z-50">提示信息</div>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script>
      // --- 核心配置 ---
      const ICONS = {
        // 请确保您的 icons 文件夹中有名为 xxx.png 的图片
        zhihu:       `<img src="icons/zhihu.png" class="w-full h-full object-contain">`,
        xiaohongshu: `<img src="icons/xiaohongshu.png" class="w-full h-full object-contain">`,
        weibo:       `<img src="icons/weibo.png" class="w-full h-full object-contain">`,
        bilibili:    `<img src="icons/bilibili.png" class="w-full h-full object-contain">`,
        taobao:      `<img src="icons/taobao.png" class="w-full h-full object-contain">`,
        pinduoduo:   `<img src="icons/pinduoduo.png" class="w-full h-full object-contain">`
      };

      const PLATFORMS = [
        { id: "zhihu", name: "知乎", icon: ICONS.zhihu, url: "https://www.zhihu.com/search?type=content&q=" },
        { id: "xiaohongshu", name: "小红书", icon: ICONS.xiaohongshu, url: "https://www.xiaohongshu.com/search_result?keyword=" },
        { id: "weibo", name: "微博", icon: ICONS.weibo, url: "https://s.weibo.com/weibo?q=" },
        { id: "bilibili", name: "哔哩哔哩", icon: ICONS.bilibili, url: "https://search.bilibili.com/all?keyword=" },
        { id: "taobao", name: "淘宝", icon: ICONS.taobao, url: "https://s.taobao.com/search?q=" },
        { id: "pinduoduo", name: "拼多多", icon: ICONS.pinduoduo, url: "https://mobile.yangkeduo.com/search_result.html?search_key=" },
      ];

      // --- 状态与元素 (保持不变) ---
      let state = {
        selectedPlatform: PLATFORMS[0],
        searchQuery: "",
        showPlatformPanel: false,
        showHistory: false,
        searchHistory: JSON.parse(localStorage.getItem('focusMode_history')) || []
      };

      const els = {
        searchInput: document.getElementById('searchInput'),
        searchBtn: document.getElementById('searchBtn'),
        platformTrigger: document.getElementById('platformTrigger'),
        currentPlatformIcon: document.getElementById('currentPlatformIcon'),
        currentPlatformName: document.getElementById('currentPlatformName'),
        platformPanel: document.getElementById('platformPanel'),
        platformGrid: document.getElementById('platformGrid'),
        historyTrigger: document.getElementById('historyTrigger'),
        historyPanel: document.getElementById('historyPanel'),
        historyList: document.getElementById('historyList'),
        clearHistory: document.getElementById('clearHistory'),
        quickJumpGrid: document.getElementById('quickJumpGrid'),
        toast: document.getElementById('toast'),
        searchBox: document.getElementById('searchBox'),
        addFavoriteTip: document.getElementById('addFavoriteTip')
      };

      // 检测设备类型的函数
      function isMobile() {
        return window.innerWidth <= 640;
      }

      function init() {
        // 延迟加载图标，避免字体加载阻塞
        setTimeout(() => {
          if (typeof lucide !== 'undefined') {
            lucide.createIcons();
          }
        }, 100);
        
        renderPlatformPanel();
        renderQuickJump();
        renderHistoryList();
        updateSelectedPlatformUI();
        
        // 绑定事件 (保持不变)
        els.platformTrigger.onclick = (e) => { e.stopPropagation(); togglePlatformPanel(); };
        els.historyTrigger.onclick = (e) => { e.stopPropagation(); toggleHistoryPanel(); };
        
        els.searchInput.onfocus = () => {
          closeAllPanels();
          els.searchBox.classList.add('shadow-[0_0_0_4px_rgba(0,122,255,0.1)]', 'border-[#007AFF]');
        };
        els.searchInput.onblur = () => els.searchBox.classList.remove('shadow-[0_0_0_4px_rgba(0,122,255,0.1)]', 'border-[#007AFF]');
        
        els.searchInput.oninput = (e) => {
          state.searchQuery = e.target.value;
          const hasQuery = state.searchQuery.trim().length > 0;
          els.searchBtn.className = `touch-target px-4 sm:px-5 py-2 rounded-[10px] transition-all duration-200 flex-shrink-0 active:scale-95 flex items-center gap-2 ${hasQuery ? 'bg-[#007AFF] text-white hover:bg-[#0051D5]' : 'bg-[#86868B] text-white hover:bg-[#007AFF]'}`;
        };

        els.searchInput.onkeypress = (e) => { if (e.key === 'Enter') handleSearch(); };
        els.searchBtn.onclick = handleSearch;
        els.clearHistory.onclick = clearHistory;

        els.addFavoriteTip.onclick = (event) => {
          event.preventDefault();
          const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
          if (isIOS) {
             showToast("请点击底部 <i data-lucide='share' class='inline w-4 h-4'></i> 按钮，选择\"添加到主屏幕\"", 3000);
             setTimeout(() => {
               if (typeof lucide !== 'undefined') {
                 lucide.createIcons();
               }
             }, 10);
          } else {
             showToast("请点击浏览器菜单栏，选择\"收藏\"或\"添加到主屏幕\"", 3000);
          }
        };

        // 优化移动端事件监听
        document.addEventListener('touchstart', () => {}, {passive: true});
        
        document.onclick = (e) => {
          const searchBox = document.getElementById('searchBox');
          const toast = document.getElementById('toast');
          if (searchBox && !searchBox.contains(e.target) && !toast.contains(e.target)) {
              closeAllPanels();
          }
        };

        // 响应式处理
        window.addEventListener('resize', debounce(() => {
          renderQuickJump();
          if (typeof lucide !== 'undefined') {
            lucide.createIcons();
          }
        }, 300));
      }

      function updateSelectedPlatformUI() {
        els.currentPlatformIcon.innerHTML = state.selectedPlatform.icon;
        els.currentPlatformName.textContent = state.selectedPlatform.name;
      }

      function renderPlatformPanel() {
        const isMobileView = isMobile();
        els.platformGrid.innerHTML = PLATFORMS.map(p => `
          <button onclick="selectPlatform('${p.id}')" class="touch-target flex flex-col items-center gap-2 px-4 py-4 rounded-[12px] transition-all duration-200 ${state.selectedPlatform.id === p.id ? 'bg-white border-2 border-[#007AFF]' : 'bg-white/40 hover:bg-white/60 border-2 border-transparent'}">
            <div class="w-8 h-8 rounded-lg overflow-hidden">
              ${p.icon}
            </div>
            <span class="text-[13px] font-medium ${state.selectedPlatform.id === p.id ? 'text-[#007AFF]' : 'text-[#1D1D1F]'}">${p.name}</span>
          </button>
        `).join('');
      }

      // 优化后的 renderQuickJump 函数: 调整了 padding、图标大小和文字大小，并添加了 truncate
      function renderQuickJump() {
        const isMobileView = isMobile();
        els.quickJumpGrid.innerHTML = PLATFORMS.map(p => `
          <button onclick="selectPlatformFromQuickJump('${p.id}')" class="card-hover-effect group relative rounded-[16px] px-3 py-4 sm:px-5 sm:py-5 text-left w-full h-full mobile-card">
            <div class="relative z-10 flex items-center sm:gap-4 gap-3">
              <div class="w-8 h-8 sm:w-10 sm:h-10 flex items-center justify-center flex-shrink-0 transition-transform duration-200 group-hover:scale-110 rounded-lg overflow-hidden">
                ${p.icon}
              </div>
              <span class="platform-name text-[#1D1D1F] flex-1 group-hover:text-[#007AFF] transition-colors duration-200 text-base sm:text-[17px] truncate">${p.name}</span>
            </div>
            <div class="card-hover-gradient"></div>
          </button>
        `).join('');
      }

      function renderHistoryList() {
        if (state.searchHistory.length === 0) {
          els.historyList.innerHTML = '<div class="px-4 py-4 text-center text-[#86868B] text-sm">暂无历史记录</div>';
          return;
        }
        els.historyList.innerHTML = state.searchHistory.map((item, index) => `
          <button onclick="useHistoryItem(${index})" class="touch-target w-full flex items-center gap-3 px-3 py-2 rounded-[8px] hover:bg-white/60 transition-all text-left group">
            <i data-lucide="clock" class="w-3.5 h-3.5 text-[#86868B]"></i>
            <span class="text-[#1D1D1F] flex-1 text-[14px] truncate">${item.query}</span>
            <span class="text-[#86868B] text-[12px] bg-black/5 px-2 py-0.5 rounded flex-shrink-0">${item.platformName}</span>
          </button>
        `).join('');
        setTimeout(() => {
          if (typeof lucide !== 'undefined') {
            lucide.createIcons();
          }
        }, 10);
      }

      function togglePanel(panelEl, show) {
        if (show) {
          panelEl.classList.remove('hidden', 'panel-enter');
          setTimeout(() => panelEl.classList.add('panel-active'), 10);
        } else {
          panelEl.classList.remove('panel-active');
          const handler = function() {
            if (!panelEl.classList.contains('panel-active')) {
              panelEl.classList.add('hidden');
              panelEl.classList.add('panel-enter');
              panelEl.removeEventListener('transitionend', handler);
            }
          };
          panelEl.addEventListener('transitionend', handler);
        }
      }

      function togglePlatformPanel() {
        state.showHistory = false;
        state.showPlatformPanel = !state.showPlatformPanel;
        togglePanel(els.platformPanel, state.showPlatformPanel);
        togglePanel(els.historyPanel, state.showHistory);
      }

      function toggleHistoryPanel() {
        state.showPlatformPanel = false;
        state.showHistory = !state.showHistory;
        togglePanel(els.platformPanel, state.showPlatformPanel);
        togglePanel(els.historyPanel, state.showHistory);
      }

      function closeAllPanels() {
        state.showHistory = false;
        state.showPlatformPanel = false;
        togglePanel(els.platformPanel, false);
        togglePanel(els.historyPanel, false);
      }

      window.selectPlatform = (id) => {
        state.selectedPlatform = PLATFORMS.find(p => p.id === id);
        updateSelectedPlatformUI();
        closeAllPanels();
        renderPlatformPanel(); 
        els.searchInput.focus();
      };

      window.selectPlatformFromQuickJump = (id) => {
        state.selectedPlatform = PLATFORMS.find(p => p.id === id);
        updateSelectedPlatformUI();
        renderPlatformPanel(); 
        showToast(`已选择：${state.selectedPlatform.name}`);
      };

      window.useHistoryItem = (index) => {
        const item = state.searchHistory[index];
        els.searchInput.value = state.searchQuery = item.query;
        const platform = PLATFORMS.find(p => p.name === item.platformName);
        if (platform) { state.selectedPlatform = platform; updateSelectedPlatformUI(); }
        handleSearch();
      };

      window.clearHistory = () => {
        state.searchHistory = [];
        localStorage.setItem('focusMode_history', '[]');
        renderHistoryList();
        showToast("历史记录已清空");
      };

      function handleSearch() {
        const query = state.searchQuery.trim();
        if (!query) { showToast("请输入搜索内容"); els.searchInput.focus(); return; }
        
        const newHistory = [{ query, platformName: state.selectedPlatform.name }, ...state.searchHistory.filter(h => h.query !== query)].slice(0, 10);
        state.searchHistory = newHistory;
        localStorage.setItem('focusMode_history', JSON.stringify(newHistory));
        renderHistoryList();
        
        window.open(state.selectedPlatform.url + encodeURIComponent(query), '_blank');
        closeAllPanels();
      }

      function showToast(msg, duration = 2000) {
        const t = els.toast;
        t.innerHTML = msg; 
        t.classList.remove('opacity-0');
        setTimeout(() => t.classList.add('opacity-0'), duration);
      }

      // 防抖函数，优化性能
      function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }

      // 页面加载完成后初始化
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    </script>
  </body>
</html>